<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MY PORTFOLIO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Window styles */
    .media-container {
      position: absolute;
      border: 1px solid black;
      background: white;
      border-radius: 2px;
      opacity: 0;
      transform: scale(0.95);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                  opacity 0.35s ease,
                  box-shadow 0.25s ease;
      z-index: 10;  
      cursor: pointer;
      pointer-events: none;
      overflow: hidden;
    }
    .media-container.active {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
      z-index: 50;
    }
    .media-titlebar {
      background: #111;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
      font-family: "Courier New", monospace;
      border-bottom: 1px solid black;
      user-select: none;
      text-transform: uppercase;
    }
    .media-item {
      width: 100%;
      height: calc(100% - 28px);
      object-fit: cover;
      display: block;
      transition: none;
    }
    .fixed ul li,
    .fixed h3 {
      color: white;
      font-family: monospace;
    }

    /* Intro overlay */
    #intro-overlay {
      position: fixed;
      inset: 0;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #intro-window {
      position: relative;
      width: 320px;
      height: 120px;
      border: 1px solid black;
      background: white;
      border-radius: 2px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    #intro-window.active {
      opacity: 1;
      transform: scale(1);
    }
    #intro-window.minimised {
      transform: scale(0.2);
      opacity: 0;
    }
    #intro-titlebar {
      background: #111;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
      font-family: "Courier New", monospace;
      border-bottom: 1px solid black;
      text-transform: uppercase;
    }
    #intro-text {
      font-family: "Courier New", monospace;
      font-size: 16px;
      padding: 16px;
      white-space: pre;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 transition-colors duration-500 overflow-hidden">

  <!-- INTRO -->
  <div id="intro-overlay">
    <div id="intro-window">
      <div id="intro-titlebar">LOOPS.SZN</div>
      <div id="intro-text"></div>
    </div>
  </div>

  <!-- NAVBAR -->
  <header class="container mx-auto flex justify-between items-center py-6 px-4 border-b border-black relative z-20 opacity-0 transition-opacity duration-700" id="site-header">
    <h1 class="heading-font text-2xl">
      <a href="#" class="hover:underline">Loops.szn</a>
    </h1>
    <nav class="hidden md:flex gap-6 text-sm">
      <a href="portfolio.html" class="hover:underline">PORTFOLIO</a>
      <button class="hover:underline">PROFILE</button>
      <button class="hover:underline">CV</button>
    </nav>
    <div class="md:hidden flex items-center">
      <button id="menu-toggle" class="focus:outline-none">
        <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
    <div id="mobile-menu" class="hidden absolute right-4 top-full mt-2 w-40 bg-white border border-black rounded shadow-lg z-50 flex flex-col">
      <a href="portfolio.html" class="px-4 py-2 hover:bg-gray-200 border-b border-gray-100">PORTFOLIO</a>
      <button class="px-4 py-2 hover:bg-gray-200 border-b border-gray-100">PROFILE</button>
      <button class="px-4 py-2 hover:bg-gray-200">CV</button>
    </div>
  </header>

  <main class="relative flex flex-col items-center justify-center min-h-screen px-8 py-16 opacity-0 transition-opacity duration-700" id="site-main">
    <div class="absolute inset-0 overflow-hidden z-0" id="media-grid"></div>
    <div class="fixed bottom-8 left-8 p-4 bg-black bg-opacity-90 rounded-lg backdrop-blur-sm z-20">
      <h3 class="heading-font text-xl mb-4">PROJECTS</h3>
      <ul class="space-y-2 text-sm">
        <li class="project-item cursor-pointer hover:underline transition" data-project="sznX">01 — Szn X</li>
        <li class="project-item cursor-pointer hover:underline transition" data-project="ios26">03 — iOS 26</li>
        <li class="project-item cursor-pointer hover:underline transition" data-project="yzyApp">04 — YZY App</li>
      </ul>
    </div>
  </main>

<script>
  // Intro typing animation
  const introOverlay = document.getElementById('intro-overlay');
  const introWindow = document.getElementById('intro-window');
  const introText = document.getElementById('intro-text');
  const siteHeader = document.getElementById('site-header');
  const siteMain = document.getElementById('site-main');
  let introDone = false;

  function typeWriter(text, element, speed, callback) {
    let i = 0;
    function typing() {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(typing, speed);
      } else {
        callback && callback();
      }
    }
    typing();
  }

  function finishIntro(skip=false) {
    if (introDone) return;
    introDone = true;
    introWindow.classList.add('minimised');
    setTimeout(() => {
      introOverlay.remove();
      siteHeader.classList.remove('opacity-0');
      siteMain.classList.remove('opacity-0');
    }, skip ? 0 : 400);
  }

  window.addEventListener('load', () => {
    setTimeout(() => {
      introWindow.classList.add('active');
      typeWriter("Welcome to loops.szn", introText, 50, () => {
        setTimeout(() => finishIntro(false), 400);
      });
    }, 100);
  });

  // Skip intro on click or key
  introOverlay.addEventListener('click', () => finishIntro(true));
  window.addEventListener('keydown', () => finishIntro(true));

  // --- existing site JS below ---
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  menuToggle.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });
  document.addEventListener('click', (e) => {
    if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
      mobileMenu.classList.add('hidden');
    }
  });

  // Define projects
  const projects = {
    sznX: [
      { type: 'image', src: 'sznxgif1.gif', width: '400px', height: '250px', link: 'portfolio.html#project-1' },
      { type: 'image', src: 'sznxgif2.gif', width: '350px', height: '300px', link: 'portfolio.html#project-1' },
      { type: 'image', src: 'sznxgif3.gif', width: '500px', height: '300px', link: 'portfolio.html#project-1' }
    ],
    ios26: [
      { type: 'image', src: 'iosgif1.gif', width: '600px', height: '338px', link: 'portfolio.html#project-3' },
      { type: 'image', src: 'iosgif2.gif', width: '250px', height: '400px', link: 'portfolio.html#project-3' }
    ],
    yzyApp: [
      { type: 'image', src: 'yzyappgif1.gif', width: '400px', height: '250px', link: 'portfolio.html#project-4' },
      { type: 'image', src: 'yzyappgif2.gif', width: '350px', height: '300px', link: 'portfolio.html#project-4' },
      { type: 'image', src: 'yzyappgif3.gif', width: '500px', height: '300px', link: 'portfolio.html#project-4' }
    ]
  };

  const displayNames = {
    sznX: 'Szn X',
    ios26: 'iOS 26',
    yzyApp: 'YZY App'
  };

  const projectItems = document.querySelectorAll('.project-item');
  const mediaGrid = document.getElementById('media-grid');
  let activeMediaContainers = [];
  let autoCycleInterval;
  let userInteracted = false;
  let zIndexCounter = 50;

  function stopAutoCycle() {
    if (!userInteracted) {
      clearInterval(autoCycleInterval);
      userInteracted = true;
    }
  }

  function createMediaElement(item) {
    let element;
    if (item.type === 'image') {
      element = document.createElement('img');
      element.className = 'media-item';
      element.loading = 'lazy';
      element.dataset.src = item.src;
      element.addEventListener('click', e => {
        e.stopPropagation();
        window.location.href = item.link;
      });
    } else if (item.type === 'video') {
      element = document.createElement('video');
      element.className = 'media-item';
      element.autoplay = true;
      element.loop = true;
      element.muted = true;
      element.playsInline = true;
      element.dataset.src = item.src;
      element.addEventListener('click', e => {
        e.stopPropagation();
        window.location.href = item.link;
      });
    }
    return element;
  }

  function generateMedia(project) {
    const media = projects[project];
    if (!media) return;
    const bodyRect = document.body.getBoundingClientRect();
    const headerHeight = document.querySelector('header').offsetHeight;
    const projectListHeight = document.querySelector('.fixed').offsetHeight;
    const padding = 50;

    activeMediaContainers.forEach((container, i) => {
      container.classList.remove('active');
      container.classList.add('inactive');
      setTimeout(() => container.remove(), 400 + i * 50);
    });
    activeMediaContainers = [];
    zIndexCounter = 50;

    media.forEach((item, i) => {
      const container = document.createElement('div');
      container.className = 'media-container inactive';
      container.style.width = item.width;
      container.style.height = item.height;

      let left, top, attempts = 0, maxAttempts = 20;
      const width = parseInt(item.width), height = parseInt(item.height);
      do {
        left = Math.random() * (bodyRect.width - width - padding*2) + padding;
        top = Math.random() * (bodyRect.height - height - headerHeight - projectListHeight - padding*2) + headerHeight + padding;
        attempts++;
      } while (
        activeMediaContainers.some(c => {
          const rect = c.getBoundingClientRect();
          const overlapX = Math.abs(rect.left - left) < width * 0.6;
          const overlapY = Math.abs(rect.top - top) < height * 0.6;
          return overlapX && overlapY;
        }) && attempts < maxAttempts
      );

      container.style.left = `${left}px`;
      container.style.top = `${top}px`;
      container.style.zIndex = zIndexCounter++;

      const titlebar = document.createElement('div');
      titlebar.className = 'media-titlebar';
      titlebar.innerText = (displayNames[project] || project).toUpperCase();
      container.appendChild(titlebar);

      const content = createMediaElement(item);
      container.appendChild(content);
      setTimeout(() => content.src = content.dataset.src, 50 + i * 50);

      container.addEventListener('mouseenter', () => {
        container.classList.add('hovered');
        stopAutoCycle();
        container.style.zIndex = zIndexCounter++;
      });
      container.addEventListener('mouseleave', () => {
        container.classList.remove('hovered');
      });

      if (!('ontouchstart' in window)) {
        let offsetX, offsetY;
        container.addEventListener('mousedown', e => {
          stopAutoCycle();
          offsetX = e.clientX - container.offsetLeft;
          offsetY = e.clientY - container.offsetTop;
          container.classList.add('dragging');
          container.style.zIndex = zIndexCounter++;

          function onMouseMove(e) {
            container.style.left = `${e.clientX - offsetX}px`;
            container.style.top = `${e.clientY - offsetY}px`;
          }
          function onMouseUp() {
            container.classList.remove('dragging');
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
          }
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        });
      }

      mediaGrid.appendChild(container);
      activeMediaContainers.push(container);
      setTimeout(() => container.classList.add('active'), 100 + i * 80);
    });
  }

  projectItems.forEach(item => {
    item.addEventListener('click', () => {
      stopAutoCycle();
      const project = item.dataset.project;
      generateMedia(project);
      projectItems.forEach(i => i.classList.remove('font-bold'));
      item.classList.add('font-bold');
    });
  });

  const projectKeys = Object.keys(projects);
  let cycleIndex = 0;
  autoCycleInterval = setInterval(() => {
    if (!userInteracted) {
      const project = projectKeys[cycleIndex % projectKeys.length];
      generateMedia(project);
      cycleIndex++;
    }
  }, 3000);

  generateMedia('sznX');
  document.querySelector('.project-item[data-project="sznX"]').classList.add('font-bold');
</script>
</body>
</html>
