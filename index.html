<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MY PORTFOLIO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ----------------------------
       Window styles
    ----------------------------- */
    .media-container {
      position: absolute;
      border: 1px solid black;
      background: white;
      border-radius: 2px;
      opacity: 0;
      transform: scale(0.95);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                  opacity 0.35s ease,
                  box-shadow 0.25s ease;
      z-index: 10;
      cursor: pointer;
      pointer-events: none;
      overflow: hidden;
    }
    .media-container.active {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
      z-index: 50;
    }
    .media-titlebar {
      background: #111;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
      font-family: "Courier New", monospace;
      border-bottom: 1px solid black;
      user-select: none;
      text-transform: uppercase;
    }
    .media-item {
      width: 100%;
      height: calc(100% - 28px);
      object-fit: cover;
      display: block;
      transition: none;
    }
    .fixed ul li,
    .fixed h3 {
      color: white;
      font-family: monospace;
    }

    /* ----------------------------
       Profile Window Styles
    ----------------------------- */
    #profile-window {
      position: absolute;
      width: 450px; /* Adjusted size */
      background: white;
      border: 1px solid black;
      border-radius: 2px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transform: scale(0.98);
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s ease;
      z-index: 100; /* High z-index */
      overflow: hidden;
    }
    #profile-window.active {
      opacity: 1;
      transform: scale(1);
    }
    #profile-titlebar {
      background: #111;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
      font-family: "Courier New", monospace;
      border-bottom: 1px solid black;
      text-transform: uppercase;
      user-select: none;
      cursor: grab;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #profile-controls {
      display: flex;
      gap: 6px;
    }
    #profile-controls button {
      background: transparent;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      font-family: "Courier New", monospace;
      width: 18px;
      height: 18px;
      line-height: 1;
      text-align: center;
      padding: 0;
    }
    #profile-controls button:hover {
      background: rgba(255,255,255,0.15);
      border-radius: 2px;
    }
    #profile-content {
      display: flex;
      padding: 20px;
      gap: 20px;
      font-family: "Courier New", monospace;
      font-size: 14px;
      line-height: 1.4;
      /* Add transition for smooth minimize/maximize */
      transition: height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
    }
    #profile-content.hidden {
      height: 0;
      padding: 0 20px;
      opacity: 0;
      /* Ensure the height is effectively zero when hidden */
      margin: 0; 
      visibility: hidden; 
    }
    #profile-content img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border: 1px solid #ddd;
    }
    #profile-description {
      flex: 1;
    }


    /* ----------------------------
       Intro overlay
    ----------------------------- */
    #intro-overlay {
      position: fixed;
      inset: 0;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #intro-window {
      position: relative;
      width: 320px;
      height: 120px;
      border: 1px solid black;
      background: white;
      border-radius: 2px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    #intro-window.active {
      opacity: 1;
      transform: scale(1);
    }
    #intro-window.minimised {
      transform: scale(0.2);
      opacity: 0;
    }
    #intro-titlebar {
      background: #111;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
      font-family: "Courier New", monospace;
      border-bottom: 1px solid black;
      text-transform: uppercase;
    }
    #intro-text {
      font-family: "Courier New", monospace;
      font-size: 16px;
      padding: 16px;
      white-space: pre;
    }

    /* ----------------------------
       Parallax Grid Background
    ----------------------------- */
    #parallax-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: -1;
      will-change: transform;
      transition: transform 0.1s linear;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 transition-colors duration-500 overflow-hidden">

  <div id="parallax-grid"></div>

  <div id="intro-overlay">
    <div id="intro-window">
      <div id="intro-titlebar">LOOPS.SZN</div>
      <div id="intro-text"></div>
    </div>
  </div>

  <header class="container mx-auto flex justify-between items-center py-6 px-4 border-b border-black relative z-20 opacity-0 transition-opacity duration-700" id="site-header">
    <h1 class="text-2xl font-semibold">
      <a href="#" class="hover:underline">Loops.szn</a>
    </h1>
    <nav class="hidden md:flex gap-6 text-sm">
      <a href="portfolio.html" class="hover:underline">PORTFOLIO</a>
      <button id="profile-btn" class="hover:underline">PROFILE</button>
    </nav>
    <div class="md:hidden flex items-center">
      <button id="menu-toggle" class="focus:outline-none">
        <svg class="w-6 h-6 text-black" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
    <div id="mobile-menu" class="hidden absolute right-4 top-full mt-2 w-40 bg-white border border-black rounded shadow-lg z-50 flex flex-col">
      <a href="portfolio.html" class="px-4 py-2 hover:bg-gray-200 border-b border-gray-100">PORTFOLIO</a>
      <button id="mobile-profile-btn" class="px-4 py-2 hover:bg-gray-200 border-b border-gray-100">PROFILE</button>
      <button class="px-4 py-2 hover:bg-gray-200">CV</button>
    </div>
  </header>

  <main class="relative flex flex-col items-center justify-center min-h-screen px-8 py-16 opacity-0 transition-opacity duration-700" id="site-main">
    <div class="absolute inset-0 overflow-hidden z-0" id="media-grid"></div>
    <div class="fixed bottom-8 left-8 p-4 bg-black bg-opacity-90 rounded-lg backdrop-blur-sm z-20 fixed">
      <h3 class="text-xl font-semibold mb-4">PROJECTS</h3>
      <ul class="space-y-2 text-sm">
        <li class="project-item cursor-pointer hover:underline transition" data-project="sznX">01 — Szn X</li>
        <li class="project-item cursor-pointer hover:underline transition" data-project="ios26">03 — iOS 26</li>
        <li class="project-item cursor-pointer hover:underline transition" data-project="yzyApp">04 — YZY App</li>
      </ul>
    </div>
  </main>

<script>
  // -----------------------------
  // Intro typing animation
  // -----------------------------
  const introOverlay = document.getElementById('intro-overlay');
  const introWindow = document.getElementById('intro-window');
  const introText = document.getElementById('intro-text');
  const siteHeader = document.getElementById('site-header');
  const siteMain = document.getElementById('site-main');
  let introDone = false;

  function typeWriter(text, element, speed, callback) {
    let i = 0;
    function typing() {
      if (i < text.length) {
        element.textContent += text.charAt(i);
        i++;
        setTimeout(typing, speed);
      } else {
        callback && callback();
      }
    }
    typing();
  }

  function finishIntro(skip=false) {
    if (introDone) return;
    introDone = true;
    introWindow.classList.add('minimised');
    setTimeout(() => {
      introOverlay.remove();
      siteHeader.classList.remove('opacity-0');
      siteMain.classList.remove('opacity-0');
    }, skip ? 0 : 400);
  }

  function playIntro() {
    setTimeout(() => {
      introWindow.classList.add('active');
      typeWriter("Welcome to loops.szn", introText, 50, () => {
        setTimeout(() => finishIntro(false), 400);
      });
    }, 100);
  }

  // Visit counter
  let visitCount = parseInt(localStorage.getItem("visitCount") || "0", 10);
  visitCount++;
  localStorage.setItem("visitCount", visitCount);

  window.addEventListener('load', () => {
    if (visitCount === 1 || visitCount % 3 === 0) {
      playIntro();
    } else {
      finishIntro(true);
    }
  });

  // Skip intro on click or key
  introOverlay.addEventListener('click', () => finishIntro(true));
  window.addEventListener('keydown', () => finishIntro(true));

  // -----------------------------
  // Parallax grid movement
  // -----------------------------
  const grid = document.getElementById('parallax-grid');
  document.addEventListener('mousemove', e => {
    const { innerWidth, innerHeight } = window;
    const x = (e.clientX / innerWidth - 0.5) * 20;
    const y = (e.clientY / innerHeight - 0.5) * 20;
    grid.style.transform = `translate(${x}px, ${y}px)`;
  });

  // -----------------------------
  // Existing site JS
  // -----------------------------
  const menuToggle = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  menuToggle.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });
  document.addEventListener('click', (e) => {
    if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
      mobileMenu.classList.add('hidden');
    }
  });

  // Projects data
  const projects = {
    sznX: [
      { type: 'image', src: 'sznxgif1.gif', width: '400px', height: '250px', link: 'portfolio.html#project-1' },
      { type: 'image', src: 'sznxgif2.gif', width: '350px', height: '300px', link: 'portfolio.html#project-1' },
      { type: 'image', src: 'sznxgif3.gif', width: '500px', height: '300px', link: 'portfolio.html#project-1' }
    ],
    ios26: [
      { type: 'image', src: 'iosgif1.gif', width: '600px', height: '338px', link: 'portfolio.html#project-3' },
      { type: 'image', src: 'iosgif2.gif', width: '250px', height: '400px', link: 'portfolio.html#project-3' }
    ],
    yzyApp: [
      { type: 'image', src: 'yzyappgif1.gif', width: '400px', height: '250px', link: 'portfolio.html#project-4' },
      { type: 'image', src: 'yzyappgif2.gif', width: '350px', height: '300px', link: 'portfolio.html#project-4' },
      { type: 'image', src: 'yzyappgif3.gif', width: '500px', height: '300px', link: 'portfolio.html#project-4' }
    ]
  };

  const displayNames = {
    sznX: 'Szn X',
    ios26: 'iOS 26',
    yzyApp: 'YZY App'
  };

  const projectItems = document.querySelectorAll('.project-item');
  const mediaGrid = document.getElementById('media-grid');
  let activeMediaContainers = [];
  let autoCycleInterval;
  let userInteracted = false;
  let zIndexCounter = 50;

  function stopAutoCycle() {
    if (!userInteracted) {
      clearInterval(autoCycleInterval);
      userInteracted = true;
    }
  }

  function createMediaElement(item) {
    let element;
    if (item.type === 'image') {
      element = document.createElement('img');
      element.className = 'media-item';
      element.loading = 'lazy';
      element.dataset.src = item.src;
      element.addEventListener('click', e => {
        e.stopPropagation();
        window.location.href = item.link;
      });
    } else if (item.type === 'video') {
      element = document.createElement('video');
      element.className = 'media-item';
      element.autoplay = true;
      element.loop = true;
      element.muted = true;
      element.playsInline = true;
      element.dataset.src = item.src;
      element.addEventListener('click', e => {
        e.stopPropagation();
        window.location.href = item.link;
      });
    }
    return element;
  }

  function generateMedia(project) {
    const media = projects[project];
    if (!media) return;
    const bodyRect = document.body.getBoundingClientRect();
    const headerHeight = document.querySelector('header').offsetHeight;
    // Safely get height of the fixed project list
    const fixedElement = document.querySelector('.fixed');
    const projectListHeight = fixedElement ? fixedElement.offsetHeight : 0;
    const padding = 50;

    activeMediaContainers.forEach((container, i) => {
      container.classList.remove('active');
      container.classList.add('inactive');
      setTimeout(() => container.remove(), 400 + i * 50);
    });
    activeMediaContainers = [];
    zIndexCounter = 50;

    media.forEach((item, i) => {
      const container = document.createElement('div');
      container.className = 'media-container inactive';
      container.style.width = item.width;
      container.style.height = item.height;

      let left, top, attempts = 0, maxAttempts = 20;
      const width = parseInt(item.width), height = parseInt(item.height);
      do {
        left = Math.random() * (bodyRect.width - width - padding*2) + padding;
        top = Math.random() * (bodyRect.height - height - headerHeight - projectListHeight - padding*2) + headerHeight + padding;
        attempts++;
      } while (
        activeMediaContainers.some(c => {
          const rect = c.getBoundingClientRect();
          const overlapX = Math.abs(rect.left - left) < width * 0.6;
          const overlapY = Math.abs(rect.top - top) < height * 0.6;
          return overlapX && overlapY;
        }) && attempts < maxAttempts
      );

      container.style.left = `${left}px`;
      container.style.top = `${top}px`;
      container.style.zIndex = zIndexCounter++;

      const titlebar = document.createElement('div');
      titlebar.className = 'media-titlebar';
      titlebar.innerText = (displayNames[project] || project).toUpperCase();
      container.appendChild(titlebar);

      const content = createMediaElement(item);
      container.appendChild(content);
      setTimeout(() => content.src = content.dataset.src, 50 + i * 50);

      container.addEventListener('mouseenter', () => {
        container.classList.add('hovered');
        stopAutoCycle();
        container.style.zIndex = zIndexCounter++;
      });
      container.addEventListener('mouseleave', () => {
        container.classList.remove('hovered');
      });

      if (!('ontouchstart' in window)) {
        let offsetX, offsetY;
        container.addEventListener('mousedown', e => {
          stopAutoCycle();
          offsetX = e.clientX - container.offsetLeft;
          offsetY = e.clientY - container.offsetTop;
          container.classList.add('dragging');
          container.style.zIndex = zIndexCounter++;

          function onMouseMove(e) {
            container.style.left = `${e.clientX - offsetX}px`;
            container.style.top = `${e.clientY - offsetY}px`;
          }
          function onMouseUp() {
            container.classList.remove('dragging');
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
          }
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        });
      }

      mediaGrid.appendChild(container);
      activeMediaContainers.push(container);
      setTimeout(() => container.classList.add('active'), 100 + i * 80);
    });
  }

  projectItems.forEach(item => {
    item.addEventListener('click', () => {
      stopAutoCycle();
      const project = item.dataset.project;
      generateMedia(project);
      projectItems.forEach(i => i.classList.remove('font-bold'));
      item.classList.add('font-bold');
    });
  });

  const projectKeys = Object.keys(projects);
  let cycleIndex = 0;
  autoCycleInterval = setInterval(() => {
    if (!userInteracted) {
      const project = projectKeys[cycleIndex % projectKeys.length];
      generateMedia(project);
      cycleIndex++;
    }
  }, 3000);

  generateMedia('sznX');
  document.querySelector('.project-item[data-project="sznX"]').classList.add('font-bold');


  // -----------------------------
  // Profile Window Logic
  // -----------------------------
  const profileButton = document.getElementById('profile-btn');
  const mobileProfileButton = document.getElementById('mobile-profile-btn');
  let profileWindow = null;

  function createProfileWindow() {
    if (profileWindow) {
        // If window already exists, bring it to the front
        profileWindow.style.zIndex = zIndexCounter++;
        return;
    }

    profileWindow = document.createElement('div');
    profileWindow.id = 'profile-window';
    profileWindow.style.zIndex = zIndexCounter++; // Set initial z-index

    const titlebar = document.createElement('div');
    titlebar.id = 'profile-titlebar';
    titlebar.innerHTML = `
      <span>PROFILE</span>
      <div id="profile-controls">
        <button id="profile-minimise">–</button>
        <button id="profile-close">×</button>
      </div>
    `;
        const content = document.createElement('div');
        content.id = 'profile-content';
        // UPDATED CONTENT HERE
     content.innerHTML = `
          <img src="portrait.jpg" alt="Portrait">
          <div id="profile-description">
          <h2 class="text-lg font-bold mb-2">Loops.szn</h2>
          <p>Loops.szn is a motion designer with extensive experience, including work on the YZY App. He crafts fluid, impactful animations that merge technical skill with creative vision.</p>
          <br> <p>Always in beta. Always in loops.</p>
          </div>
        `;

    profileWindow.appendChild(titlebar);
    profileWindow.appendChild(content);
    document.body.appendChild(profileWindow);

    // Center on screen once its size is calculated
    const { innerWidth, innerHeight } = window;
    profileWindow.style.left = `${(innerWidth - profileWindow.offsetWidth) / 2}px`;
    profileWindow.style.top = `${(innerHeight - profileWindow.offsetHeight) / 2}px`;

    // Window focus (bring to front on click)
    profileWindow.addEventListener('mousedown', () => {
        profileWindow.style.zIndex = zIndexCounter++;
    });


    // Minimise toggle (Updated with requested logic)
    const minimiseBtn = profileWindow.querySelector('#profile-minimise');
    minimiseBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent drag from starting on button click
      content.classList.toggle('hidden');
      minimiseBtn.textContent = content.classList.contains('hidden') ? '+' : '–';
    });

    // Close button
    const closeBtn = profileWindow.querySelector('#profile-close');
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent drag from starting on button click
      profileWindow.classList.remove('active'); // Fade out effect
      setTimeout(() => {
        profileWindow.remove();
        profileWindow = null;
      }, 200); // Match CSS transition duration
    });

    // Draggable by titlebar (not buttons)
    let offsetX, offsetY;
    titlebar.addEventListener('mousedown', e => {
      if (e.target.closest('#profile-controls')) return; // don’t drag when clicking buttons

      // Bring to front on drag start
      profileWindow.style.zIndex = zIndexCounter++;
      
      offsetX = e.clientX - profileWindow.offsetLeft;
      offsetY = e.clientY - profileWindow.offsetTop;
      
      function onMouseMove(e) {
        profileWindow.style.left = `${e.clientX - offsetX}px`;
        profileWindow.style.top = `${e.clientY - offsetY}px`;
      }
      function onMouseUp() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    });

    setTimeout(() => profileWindow.classList.add('active'), 50);
  }

  // Event listeners for the buttons
  profileButton.addEventListener('click', createProfileWindow);
  mobileProfileButton.addEventListener('click', () => {
    createProfileWindow();
    mobileMenu.classList.add('hidden'); // Close mobile menu after clicking
  });
</script>
</body>
</html>